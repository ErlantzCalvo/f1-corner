---
import Layout from '../../layouts/Layout.astro';
import Leaderboard from '../../components/Leaderboard.astro';
import Podium from '../../components/Podium.astro';
import {getCurrentDriverStandings} from '../../api/standings'
import { getArticleImage } from '../../api/wikipedia'

const standings = await getCurrentDriverStandings();
const driversInfo = await Promise.all(standings.map( async ({ Driver: driver, points})  => {
	const wikiUrlParts = driver.url.split('/');
	const wikiDriverName = wikiUrlParts[wikiUrlParts.length - 1];
	const imageUrl = await getArticleImage(wikiDriverName, 120) || "/user.png";
	return {
		name: `${driver.givenName} ${driver.familyName}`,
		points: points,
		image: imageUrl
	}
}))

---

<Layout title="Ranking">
	<h1>Clasificaci√≥n</h1>
	<section>
		<Podium first={driversInfo.length > 0? driversInfo[0] : null} 
			second={driversInfo.length > 1? driversInfo[1] : null} 
			third={driversInfo.length > 2? driversInfo[2] : null}/>
		<Leaderboard items={driversInfo}/>
	</section>
</Layout>

<style>
	html {
		overflow-x: hidden;
	}
	
</style>
